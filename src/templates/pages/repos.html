{% extends "layouts/base.html" %} {% block title %}Repositories -
Rustassistant{% endblock %} {% block content %}
<div class="page-header mb-4">
    <div
        style="
            display: flex;
            justify-content: space-between;
            align-items: center;
        "
    >
        <div>
            <h1>Repositories</h1>
            <p class="text-muted">Track and analyze your code repositories</p>
        </div>
        <a href="/repos/new" class="btn btn-primary">+ Add Repository</a>
    </div>
</div>

<!-- Repositories List -->
{% if repos.len() > 0 %}
<div class="grid grid-2">
    {% for repo in repos %}
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">üì¶ {{ repo.name }}</h2>
            <div style="display: flex; gap: 0.5rem">
                <button
                    class="btn btn-sm btn-primary"
                    onclick="analyzeRepo({{ repo.id }})"
                >
                    Analyze
                </button>
                <button
                    class="btn btn-sm btn-secondary"
                    onclick="viewTree({{ repo.id }})"
                >
                    View Tree
                </button>
            </div>
        </div>

        <div style="padding: 1rem">
            <div style="margin-bottom: 1rem">
                <div
                    class="text-muted"
                    style="font-size: 0.75rem; margin-bottom: 0.25rem"
                >
                    Path
                </div>
                <code
                    style="
                        display: block;
                        padding: 0.5rem;
                        background: var(--bg);
                        border-radius: 0.25rem;
                        font-size: 0.875rem;
                        word-break: break-all;
                    "
                >
                    {{ repo.path }}
                </code>
            </div>

            <!-- Scan Settings -->
            <div
                style="
                    margin-bottom: 1rem;
                    padding: 1rem;
                    background: var(--bg);
                    border-radius: 0.25rem;
                    border: 1px solid var(--border);
                "
            >
                <h3
                    style="
                        font-size: 0.875rem;
                        font-weight: 600;
                        margin-bottom: 0.75rem;
                    "
                >
                    ‚öôÔ∏è Scan Settings
                </h3>
                <form
                    id="settings-form-{{ repo.id }}"
                    hx-post="/repos/{{ repo.id }}/settings"
                    hx-swap="none"
                    style="display: grid; gap: 0.75rem"
                >
                    <!-- Auto-scan Toggle -->
                    <div
                        style="
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                        "
                    >
                        <label
                            for="auto-scan-{{ repo.id }}"
                            style="
                                font-size: 0.875rem;
                                color: var(--text-muted);
                            "
                        >
                            Auto-Scan Enabled
                        </label>
                        <input
                            type="checkbox"
                            id="auto-scan-{{ repo.id }}"
                            name="auto_scan_enabled"
                            value="true"
                            {%
                            if
                            repo.auto_scan_enabled
                            %}checked{%
                            endif
                            %}
                            onchange="document.getElementById('settings-form-{{ repo.id }}').requestSubmit()"
                            style="width: auto; cursor: pointer"
                        />
                    </div>

                    <!-- Scan Interval -->
                    <div
                        style="
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                            gap: 1rem;
                        "
                    >
                        <label
                            for="interval-{{ repo.id }}"
                            style="
                                font-size: 0.875rem;
                                color: var(--text-muted);
                                white-space: nowrap;
                            "
                        >
                            Scan Interval (minutes)
                        </label>
                        <div
                            style="
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                                flex: 1;
                                max-width: 200px;
                            "
                        >
                            <input
                                type="number"
                                id="interval-{{ repo.id }}"
                                name="scan_interval_minutes"
                                value="{{ repo.scan_interval_minutes }}"
                                min="5"
                                max="1440"
                                style="
                                    width: 80px;
                                    padding: 0.25rem 0.5rem;
                                    font-size: 0.875rem;
                                "
                            />
                            <button
                                type="submit"
                                class="btn btn-sm btn-primary"
                                style="padding: 0.25rem 0.75rem"
                            >
                                Save
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Scan Progress Indicator -->
            <div
                id="progress-{{ repo.id }}"
                hx-get="/repos/{{ repo.id }}/progress"
                hx-trigger="load, every 3s"
                hx-swap="outerHTML"
            >
                <!-- Progress will be loaded here via HTMX -->
            </div>

            <div
                style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding-top: 1rem;
                    border-top: 1px solid var(--border);
                "
            >
                <div class="text-muted" style="font-size: 0.75rem">
                    Added: {{ repo.created_at }}
                </div>
                <div style="display: flex; gap: 0.5rem">
                    <button
                        class="btn btn-sm btn-secondary"
                        onclick="refreshRepo({{ repo.id }})"
                    >
                        üîÑ Refresh
                    </button>
                    <button
                        class="btn btn-sm btn-danger"
                        onclick="deleteRepo({{ repo.id }})"
                    >
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <div style="text-align: center; padding: 4rem 2rem">
        <div style="font-size: 4rem; margin-bottom: 1rem">üì¶</div>
        <h2 style="margin-bottom: 1rem">No Repositories Yet</h2>
        <p class="text-muted" style="margin-bottom: 2rem">
            Add a repository to start analyzing your code with AI-powered
            insights.
        </p>
        <a href="/repos/new" class="btn btn-primary"
            >Add Your First Repository</a
        >
    </div>
</div>
{% endif %}

<!-- Quick Stats -->
{% if repos.len() > 0 %}
<div class="card mt-4">
    <div class="card-header">
        <h2 class="card-title">Quick Stats</h2>
    </div>
    <div class="grid grid-3" style="padding: 1rem">
        <div class="stat-card">
            <div class="stat-value">{{ repos.len() }}</div>
            <div class="stat-label">Total Repositories</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">-</div>
            <div class="stat-label">Total Files</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">-</div>
            <div class="stat-label">Analyses Run</div>
        </div>
    </div>
</div>
{% endif %} {% endblock %} {% block extra_scripts %}
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<script>
    function analyzeRepo(id) {
        window.location.href = "/analyze?repo=" + id;
    }

    function viewTree(id) {
        alert("View tree functionality coming soon! Repo ID: " + id);
        // TODO: Implement tree viewer
    }

    function refreshRepo(id) {
        alert("Refresh functionality coming soon! Repo ID: " + id);
        // TODO: Implement refresh API call with HTMX
    }

    function deleteRepo(id) {
        if (
            confirm(
                "Are you sure you want to delete this repository? This will not delete the actual files, only remove it from Rustassistant tracking.",
            )
        ) {
            alert("Delete functionality coming soon! Repo ID: " + id);
            // TODO: Implement delete API call
        }
    }

    // Toast notification handler for HTMX
    document.body.addEventListener("showToast", function (evt) {
        const detail = evt.detail;
        const toast = document.createElement("div");
        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: ${detail.type === "success" ? "#22c55e" : detail.type === "error" ? "#ef4444" : "#3b82f6"};
            color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            z-index: 9999;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        `;
        toast.textContent = detail.message;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.style.animation = "slideOut 0.3s ease-in";
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    });
</script>
<style>
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
</style>
{% endblock %}
