{% extends "layouts/base.html" %}

{% block title %}Repositories - Rustassistant{% endblock %}

{% block content %}
<div class="page-header mb-4">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1>Repositories</h1>
            <p class="text-muted">Track and analyze your code repositories</p>
        </div>
        <a href="/repos/new" class="btn btn-primary">+ Add Repository</a>
    </div>
</div>

<!-- Repositories List -->
{% if repos.len() > 0 %}
<div class="grid grid-2">
    {% for repo in repos %}
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">ðŸ“¦ {{ repo.name }}</h2>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-sm btn-primary" onclick="analyzeRepo({{ repo.id }})">Analyze</button>
                <button class="btn btn-sm btn-secondary" onclick="viewTree({{ repo.id }})">View Tree</button>
            </div>
        </div>

        <div style="padding: 1rem;">
            <div style="margin-bottom: 1rem;">
                <div class="text-muted" style="font-size: 0.75rem; margin-bottom: 0.25rem;">Path</div>
                <code style="display: block; padding: 0.5rem; background: var(--bg); border-radius: 0.25rem; font-size: 0.875rem; word-break: break-all;">
                    {{ repo.path }}
                </code>
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--border);">
                <div class="text-muted" style="font-size: 0.75rem;">
                    Added: {{ repo.created_at }}
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-sm btn-secondary" onclick="refreshRepo({{ repo.id }})">ðŸ”„ Refresh</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteRepo({{ repo.id }})">Delete</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <div style="text-align: center; padding: 4rem 2rem;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ“¦</div>
        <h2 style="margin-bottom: 1rem;">No Repositories Yet</h2>
        <p class="text-muted" style="margin-bottom: 2rem;">
            Add a repository to start analyzing your code with AI-powered insights.
        </p>
        <a href="/repos/new" class="btn btn-primary">Add Your First Repository</a>
    </div>
</div>
{% endif %}

<!-- Quick Stats -->
{% if repos.len() > 0 %}
<div class="card mt-4">
    <div class="card-header">
        <h2 class="card-title">Quick Stats</h2>
    </div>
    <div class="grid grid-3" style="padding: 1rem;">
        <div class="stat-card">
            <div class="stat-value">{{ repos.len() }}</div>
            <div class="stat-label">Total Repositories</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">-</div>
            <div class="stat-label">Total Files</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">-</div>
            <div class="stat-label">Analyses Run</div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_scripts %}
<script>
    function analyzeRepo(id) {
        window.location.href = '/analyze?repo=' + id;
    }

    function viewTree(id) {
        alert('View tree functionality coming soon! Repo ID: ' + id);
        // TODO: Implement tree viewer
    }

    function refreshRepo(id) {
        alert('Refresh functionality coming soon! Repo ID: ' + id);
        // TODO: Implement refresh API call with HTMX
    }

    function deleteRepo(id) {
        if (confirm('Are you sure you want to delete this repository? This will not delete the actual files, only remove it from Rustassistant tracking.')) {
            alert('Delete functionality coming soon! Repo ID: ' + id);
            // TODO: Implement delete API call
        }
    }
</script>
{% endblock %}
